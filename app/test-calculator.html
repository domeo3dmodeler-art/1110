<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–≤–µ—Ä–µ–π DOMEO</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .loading { border-left: 4px solid #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .photo-test {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .photo-preview {
            width: 200px;
            height: 150px;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }
        .photo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–≤–µ—Ä–µ–π DOMEO</h1>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ API —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>

        <div class="test-section">
            <h2>üìä –¢–µ—Å—Ç API —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h2>
            <div class="photo-test">
                <div>
                    <button onclick="testPhotosAPI('modern')">–¢–µ—Å—Ç Modern</button>
                    <button onclick="testPhotosAPI('classic')">–¢–µ—Å—Ç Classic</button>
                    <button onclick="testPhotosAPI('hidden')">–¢–µ—Å—Ç Hidden</button>
                    <button onclick="testPhotosAPI('aluminum')">–¢–µ—Å—Ç Aluminum</button>
                </div>
                <div class="photo-preview" id="photoPreview">
                    <span>–§–æ—Ç–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</span>
                </div>
            </div>
            <div class="test-result" id="photosResult"></div>
        </div>

        <div class="test-section">
            <h2>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h2>
            <button onclick="performanceTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            <div class="test-result" id="performanceResult"></div>
        </div>

        <div class="test-section">
            <h2>üîß –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ API</h2>
            <button onclick="testOptimizedAPI()">–¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ API</button>
            <div class="test-result" id="optimizedResult"></div>
        </div>

        <div class="test-section">
            <h2>üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ API</h2>
            <button onclick="compareAPIs()">–°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π API</button>
            <div class="test-result" id="compareResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        async function testPhotosAPI(model) {
            const resultDiv = document.getElementById('photosResult');
            const photoPreview = document.getElementById('photoPreview');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = `üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –º–æ–¥–µ–ª–∏: ${model}...`;
            
            try {
                const startTime = performance.now();
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API
                const response = await fetch(`${API_BASE}/api/catalog/doors/photos-optimized?model=${encodeURIComponent(model)}`);
                const data = await response.json();
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                if (data.ok && data.photos && data.photos.length > 0) {
                    const photoUrl = data.photos[0].startsWith('/uploads') ? data.photos[0] : `/uploads${data.photos[0]}`;
                    photoPreview.innerHTML = `<img src="${API_BASE}${photoUrl}" alt="–î–≤–µ—Ä—å ${model}" onerror="this.parentElement.innerHTML='<span>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>'">`;
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `‚úÖ –£—Å–ø–µ—à–Ω–æ! –ù–∞–π–¥–µ–Ω–æ ${data.photos.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞ ${duration}–º—Å\n–ú–æ–¥–µ–ª—å: ${data.model}\n–ö—ç—à–∏—Ä–æ–≤–∞–Ω–æ: ${data.cached ? '–î–∞' : '–ù–µ—Ç'}`;
                } else {
                    photoPreview.innerHTML = '<span>–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span>';
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = `‚ùå –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –º–æ–¥–µ–ª–∏: ${model}\n–í—Ä–µ–º—è: ${duration}–º—Å`;
                }
            } catch (error) {
                photoPreview.innerHTML = '<span>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</span>';
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function performanceTest() {
            const resultDiv = document.getElementById('performanceResult');
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...';
            
            const models = ['modern', 'classic', 'hidden', 'aluminum', 'neoclassic'];
            const results = [];
            
            for (const model of models) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(`${API_BASE}/api/catalog/doors/photos-optimized?model=${model}`);
                    const data = await response.json();
                    const endTime = performance.now();
                    
                    results.push({
                        model,
                        duration: Math.round(endTime - startTime),
                        photos: data.photos ? data.photos.length : 0,
                        cached: data.cached || false
                    });
                } catch (error) {
                    results.push({
                        model,
                        duration: 0,
                        photos: 0,
                        cached: false,
                        error: error.message
                    });
                }
            }
            
            const totalTime = results.reduce((sum, r) => sum + r.duration, 0);
            const avgTime = Math.round(totalTime / results.length);
            
            resultDiv.className = 'test-result success';
            resultDiv.textContent = `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:\n\n` +
                results.map(r => `${r.model}: ${r.duration}–º—Å, ${r.photos} —Ñ–æ—Ç–æ, –∫—ç—à: ${r.cached ? '–î–∞' : '–ù–µ—Ç'}`).join('\n') +
                `\n\n‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalTime}–º—Å\nüìà –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: ${avgTime}–º—Å`;
        }

        async function testOptimizedAPI() {
            const resultDiv = document.getElementById('optimizedResult');
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API...';
            
            try {
                const startTime = performance.now();
                const response = await fetch(`${API_BASE}/api/catalog/doors/photos-optimized?model=modern`);
                const data = await response.json();
                const endTime = performance.now();
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n` +
                    `–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${Math.round(endTime - startTime)}–º—Å\n` +
                    `–°—Ç–∞—Ç—É—Å: ${data.ok ? 'OK' : 'Error'}\n` +
                    `–ú–æ–¥–µ–ª—å: ${data.model}\n` +
                    `–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: ${data.photos ? data.photos.length : 0}\n` +
                    `–ö—ç—à–∏—Ä–æ–≤–∞–Ω–æ: ${data.cached ? '–î–∞' : '–ù–µ—Ç'}\n` +
                    `–°—Ç–∏–ª—å: ${data.style || '–ù–µ —É–∫–∞–∑–∞–Ω'}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API: ${error.message}`;
            }
        }

        async function compareAPIs() {
            const resultDiv = document.getElementById('compareResult');
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'üîÑ –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π API...';
            
            const model = 'modern';
            const results = {};
            
            try {
                // –¢–µ—Å—Ç —Å—Ç–∞—Ä–æ–≥–æ API
                const oldStart = performance.now();
                const oldResponse = await fetch(`${API_BASE}/api/catalog/doors/photos?model=${model}`);
                const oldData = await oldResponse.json();
                const oldEnd = performance.now();
                
                results.old = {
                    duration: Math.round(oldEnd - oldStart),
                    photos: oldData.photos ? oldData.photos.length : 0,
                    cached: oldData.cached || false
                };
                
                // –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ API
                const newStart = performance.now();
                const newResponse = await fetch(`${API_BASE}/api/catalog/doors/photos-optimized?model=${model}`);
                const newData = await newResponse.json();
                const newEnd = performance.now();
                
                results.new = {
                    duration: Math.round(newEnd - newStart),
                    photos: newData.photos ? newData.photos.length : 0,
                    cached: newData.cached || false
                };
                
                const improvement = results.old.duration > 0 ? 
                    Math.round((results.old.duration - results.new.duration) / results.old.duration * 100) : 0;
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ API –¥–ª—è –º–æ–¥–µ–ª–∏ "${model}":\n\n` +
                    `–°—Ç–∞—Ä—ã–π API: ${results.old.duration}–º—Å, ${results.old.photos} —Ñ–æ—Ç–æ, –∫—ç—à: ${results.old.cached ? '–î–∞' : '–ù–µ—Ç'}\n` +
                    `–ù–æ–≤—ã–π API: ${results.new.duration}–º—Å, ${results.new.photos} —Ñ–æ—Ç–æ, –∫—ç—à: ${results.new.cached ? '–î–∞' : '–ù–µ—Ç'}\n\n` +
                    `üöÄ –£–ª—É—á—à–µ–Ω–∏–µ: ${improvement}% –±—ã—Å—Ç—Ä–µ–µ`;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: ${error.message}`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            setTimeout(() => {
                testOptimizedAPI();
            }, 1000);
        });
    </script>
</body>
</html>
