# Полный анализ архитектуры системы Domeo Doors Platform

## Обзор проекта

**Domeo Doors Platform** - это NoCode платформа для создания конфигураторов товаров, специализированная на дверях. Система построена на Next.js 14 с App Router, использует Prisma ORM с SQLite базой данных и предоставляет комплексное решение для управления каталогом, создания конфигураторов и генерации документов.

## Технологический стек

### Frontend
- **Next.js 14** с App Router
- **React 18** с TypeScript
- **Tailwind CSS** для стилизации
- **Lucide React** для иконок
- **Custom Design System** с дизайн-токенами

### Backend
- **Next.js API Routes** (App Router)
- **Prisma ORM** с SQLite
- **JWT** для аутентификации
- **bcryptjs** для хеширования паролей
- **Rate Limiting** для безопасности

### Утилиты и библиотеки
- **XLSX** для работы с Excel файлами
- **Handlebars** для шаблонов документов
- **Custom PDF генератор**
- **Yandex Cloud Storage** интеграция

## Архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                        FRONTEND LAYER                           │
├─────────────────────────────────────────────────────────────────┤
│  Next.js App Router (app/)                                      │
│  ├── Layout & Pages                                             │
│  ├── Components (components/)                                   │
│  │   ├── UI Components (ui/)                                   │
│  │   ├── Constructor (constructor/)                            │
│  │   ├── Page Builder (page-builder/)                         │
│  │   ├── Calculator (calculator/)                             │
│  │   ├── Cart (cart/)                                         │
│  │   └── Admin (admin/)                                       │
│  └── Hooks (hooks/)                                            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API LAYER                               │
├─────────────────────────────────────────────────────────────────┤
│  Next.js API Routes (app/app/api/)                             │
│  ├── Authentication (auth/)                                    │
│  ├── Catalog Management (catalog/)                            │
│  ├── Product Management (products/)                            │
│  ├── Import/Export (admin/import/, admin/export/)             │
│  ├── Calculator (calculator/)                                 │
│  ├── Cart & Orders (cart/, orders/)                           │
│  ├── Documents (documents/)                                    │
│  └── Analytics (analytics/)                                   │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      BUSINESS LOGIC LAYER                      │
├─────────────────────────────────────────────────────────────────┤
│  Services & Utilities (lib/)                                   │
│  ├── Authentication (auth/)                                    │
│  ├── Database (db.ts, prisma.ts)                              │
│  ├── Design System (design/)                                   │
│  ├── Import/Export Services (import/, export/)                │
│  ├── Calculator Engine (calculator/)                          │
│  ├── Document Generation (documents/, pdf/)                   │
│  ├── Cache Management (cache/)                                │
│  ├── Security (security/)                                     │
│  └── Monitoring (monitoring/)                                  │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       DATA LAYER                               │
├─────────────────────────────────────────────────────────────────┤
│  Prisma ORM + SQLite Database                                  │
│  ├── Users & Authentication                                    │
│  ├── Catalog Categories & Products                            │
│  ├── Product Properties & Assignments                          │
│  ├── Import Templates & History                               │
│  ├── Constructor Configurations                               │
│  ├── Frontend Categories                                       │
│  ├── Documents (Quotes, Orders, Invoices)                      │
│  ├── Clients & Notifications                                  │
│  └── System Settings                                          │
└─────────────────────────────────────────────────────────────────┘
```

## Основные модули системы

### 1. Система аутентификации
- **JWT токены** с безопасным хешированием паролей
- **Роли пользователей** (admin, user)
- **Rate limiting** для защиты от брутфорса
- **Middleware** для проверки авторизации

### 2. Управление каталогом
- **Иерархическая структура** категорий (до 4 уровней)
- **Гибкие свойства товаров** с типами данных
- **Привязка свойств** к категориям
- **Импорт/экспорт** данных из Excel
- **Система шаблонов** для импорта

### 3. Конструктор страниц (Page Builder)
- **Drag & Drop интерфейс** для создания страниц
- **Библиотека компонентов** (текст, изображения, кнопки, формы)
- **Система связей** между компонентами
- **Адаптивный дизайн** с брейкпоинтами
- **История изменений** (undo/redo)

### 4. Конструктор конфигураторов
- **NoCode создание** конфигураторов товаров
- **Визуальный редактор** с канвасом
- **Система блоков** (каталог, фильтры, калькулятор)
- **Профессиональные шаблоны**
- **Экспорт настроек**

### 5. Калькулятор стоимости
- **Формульный движок** для расчетов
- **Интеграция с каталогом** товаров
- **Настраиваемые параметры** расчета
- **Экспорт результатов** в документы

### 6. Система корзины и заказов
- **Мультикатегорийная корзина**
- **Управление клиентами**
- **Генерация документов** (КП, счета, заказы)
- **Экспорт в различные форматы**

### 7. Система документооборота
- **Шаблоны документов** (Handlebars)
- **PDF генерация**
- **Excel экспорт**
- **Уведомления** клиентам

### 8. Аналитика и мониторинг
- **Метрики использования**
- **Анализ продаж**
- **Производительность системы**
- **Логирование операций**

## Структура базы данных

### Основные таблицы:
1. **users** - Пользователи системы
2. **catalog_categories** - Категории каталога (иерархия)
3. **products** - Товары с SKU и свойствами
4. **product_properties** - Свойства товаров
5. **category_property_assignments** - Привязка свойств к категориям
6. **import_templates** - Шаблоны импорта
7. **constructor_configurations** - Конфигурации конструкторов
8. **frontend_categories** - Категории для фронтенда
9. **clients** - Клиенты
10. **quotes/orders/invoices** - Документы
11. **pages/page_elements** - Страницы и элементы

## API Endpoints

### Аутентификация
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/register` - Регистрация

### Каталог
- `GET /api/catalog/products` - Получение товаров
- `GET /api/catalog/categories` - Получение категорий
- `GET /api/catalog/properties` - Получение свойств

### Администрирование
- `POST /api/admin/import/[category]` - Импорт данных
- `GET /api/admin/export/price-list` - Экспорт прайс-листа
- `GET /api/admin/stats` - Статистика

### Калькулятор
- `POST /api/calculator/execute` - Выполнение расчетов
- `GET /api/calculator/configs` - Получение конфигураций

### Документы
- `POST /api/quotes` - Создание КП
- `POST /api/orders` - Создание заказов
- `POST /api/invoices` - Создание счетов

## Особенности архитектуры

### 1. Модульность
- Четкое разделение на слои
- Независимые модули с собственными API
- Переиспользуемые компоненты

### 2. Масштабируемость
- Горизонтальное масштабирование через микросервисы
- Кэширование на разных уровнях
- Оптимизация запросов к БД

### 3. Безопасность
- JWT аутентификация
- Rate limiting
- Валидация входных данных
- Защита от SQL инъекций через Prisma

### 4. Производительность
- Server-side rendering (SSR)
- Статическая генерация страниц
- Оптимизация изображений
- Ленивая загрузка компонентов

### 5. Разработка
- TypeScript для типобезопасности
- Строгая типизация API
- Единая дизайн-система
- Автоматическое форматирование

## Развертывание

### Локальная разработка
```bash
npm run dev          # Запуск dev сервера
npm run build        # Сборка проекта
npm run start        # Запуск production сервера
```

### Docker
- Множественные Dockerfile для разных окружений
- Docker Compose для локальной разработки
- Интеграция с Yandex Cloud

### Production
- Оптимизированная сборка
- CDN для статических ресурсов
- Мониторинг и логирование
- Автоматические бэкапы БД

## Заключение

Domeo Doors Platform представляет собой комплексную NoCode платформу с продуманной архитектурой, которая обеспечивает:

- **Гибкость** в создании конфигураторов
- **Масштабируемость** для роста бизнеса
- **Безопасность** данных и операций
- **Производительность** для больших каталогов
- **Удобство** использования для конечных пользователей

Система готова к production использованию и может быть легко расширена новыми модулями и функциональностью.
