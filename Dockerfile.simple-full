# –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π Dockerfile –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
FROM node:18-alpine AS base

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apk add --no-cache libc6-compat

# –°–æ–∑–¥–∞–Ω–∏–µ package.json —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
RUN echo '{"name":"domeo-doors","version":"1.0.0","private":true,"scripts":{"dev":"next dev -p 3000","build":"next build","start":"next start -p 3000"},"dependencies":{"next":"14.2.5","react":"^18.2.0","react-dom":"^18.2.0","@prisma/client":"^5.22.0"},"devDependencies":{"@types/node":"^18.19.39","@types/react":"^18.2.21","@types/react-dom":"^18.2.7","prisma":"^5.22.0","typescript":"^5.5.3"}}' > package.json

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN npm install

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN mkdir -p app/api/health app/doors app/admin app/dashboard app/analytics components/ui lib prisma public

# –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
RUN echo 'export default function Home() { return (<div style={{padding:"2rem",fontFamily:"Arial,sans-serif"}}><h1>Domeo Doors - –ü–æ–ª–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1><p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–≤–µ—Ä–µ–π!</p><div style={{marginTop:"2rem"}}><h2>–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:</h2><div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:"1rem",marginTop:"1rem"}}><div style={{padding:"1rem",border:"1px solid #ccc",borderRadius:"8px"}}><h3>üö™ –ö–∞—Ç–∞–ª–æ–≥ –¥–≤–µ—Ä–µ–π</h3><p>–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –≤—ã–±–æ—Ä –¥–≤–µ—Ä–µ–π</p></div><div style={{padding:"1rem",border:"1px solid #ccc",borderRadius:"8px"}}><h3>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3><p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º</p></div><div style={{padding:"1rem",border:"1px solid #ccc",borderRadius:"8px"}}><h3>üìä –î–∞—à–±–æ—Ä–¥</h3><p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</p></div><div style={{padding:"1rem",border:"1px solid #ccc",borderRadius:"8px"}}><h3>üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3><p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</p></div></div></div><div style={{marginTop:"2rem",padding:"1rem",backgroundColor:"#f0f8ff",borderRadius:"8px"}}><h3>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</h3><ul><li>‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∞</li><li>‚úÖ API —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç</li><li>‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</li><li>‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ</li></ul></div></div>); }' > app/page.tsx

# –°–æ–∑–¥–∞–Ω–∏–µ layout
RUN echo 'export const metadata = { title: "Domeo Doors", description: "–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–≤–µ—Ä–µ–π" }; export default function RootLayout({ children }) { return (<html lang="ru"><body><nav style={{backgroundColor:"#f8f9fa",padding:"1rem",borderBottom:"1px solid #dee2e6"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><a href="/" style={{textDecoration:"none",color:"#333",fontSize:"1.5rem",fontWeight:"bold"}}>Domeo Doors</a><div style={{display:"flex",gap:"1rem"}}><a href="/doors" style={{textDecoration:"none",color:"#666"}}>–ö–∞—Ç–∞–ª–æ–≥</a><a href="/admin" style={{textDecoration:"none",color:"#666"}}>–ê–¥–º–∏–Ω</a><a href="/dashboard" style={{textDecoration:"none",color:"#666"}}>–î–∞—à–±–æ—Ä–¥</a><a href="/analytics" style={{textDecoration:"none",color:"#666"}}>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></div></div></nav>{children}</body></html>); }' > app/layout.tsx

# –°–æ–∑–¥–∞–Ω–∏–µ API health check
RUN echo 'import { NextResponse } from "next/server"; export async function GET() { return NextResponse.json({ status: "ok", message: "Domeo Doors API is running", timestamp: new Date().toISOString(), version: "1.0.0" }); }' > app/api/health/route.ts

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞
RUN echo 'export default function DoorsPage() { return (<div style={{padding:"2rem",fontFamily:"Arial,sans-serif"}}><h1>üö™ –ö–∞—Ç–∞–ª–æ–≥ –¥–≤–µ—Ä–µ–π</h1><p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –¥–≤–µ—Ä–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–æ–∏—Å–∫–æ–º</p><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(300px,1fr))",gap:"1rem",marginTop:"2rem"}}><div style={{padding:"1rem",border:"1px solid #ddd",borderRadius:"8px"}}><h3>–ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –¥–≤–µ—Ä–∏</h3><p>–ö–æ–ª–ª–µ–∫—Ü–∏—è –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω—ã—Ö –¥–≤–µ—Ä–µ–π</p><button style={{padding:"0.5rem 1rem",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px"}}>–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button></div><div style={{padding:"1rem",border:"1px solid #ddd",borderRadius:"8px"}}><h3>–í—Ö–æ–¥–Ω—ã–µ –¥–≤–µ—Ä–∏</h3><p>–ö–æ–ª–ª–µ–∫—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–≤–µ—Ä–µ–π</p><button style={{padding:"0.5rem 1rem",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px"}}>–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button></div></div></div>); }' > app/doors/page.tsx

# –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
RUN echo 'export default function AdminPage() { return (<div style={{padding:"2rem",fontFamily:"Arial,sans-serif"}}><h1>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1><p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</p><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(250px,1fr))",gap:"1rem",marginTop:"2rem"}}><div style={{padding:"1rem",border:"1px solid #ddd",borderRadius:"8px"}}><h3>üì¶ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤</h3><p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–∑ Excel</p><button style={{padding:"0.5rem 1rem",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px"}}>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div><div style={{padding:"1rem",border:"1px solid #ddd",borderRadius:"8px"}}><h3>üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</h3><p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–Ω –∏ —Å–∫–∏–¥–æ–∫</p><button style={{padding:"0.5rem 1rem",backgroundColor:"#ffc107",color:"black",border:"none",borderRadius:"4px"}}>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button></div><div style={{padding:"1rem",border:"1px solid #ddd",borderRadius:"8px"}}><h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3><p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p><button style={{padding:"0.5rem 1rem",backgroundColor:"#6f42c1",color:"white",border:"none",borderRadius:"4px"}}>–£–ø—Ä–∞–≤–ª—è—Ç—å</button></div></div></div>); }' > app/admin/page.tsx

# –°–æ–∑–¥–∞–Ω–∏–µ Prisma —Å—Ö–µ–º—ã
RUN echo 'generator client { provider = "prisma-client-js" } datasource db { provider = "postgresql" url = env("DATABASE_URL") } model User { id String @id @default(cuid()) email String @unique password String role String @default("user") createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } model Product { id String @id @default(cuid()) name String category String price Float description String? createdAt DateTime @default(now()) updatedAt DateTime @updatedAt }' > prisma/schema.prisma

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞
RUN npx prisma generate

# –°–±–æ—Ä–∫–∞ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN npm run build

# –ü—Ä–æ–¥–∞–∫—à–Ω –æ–±—Ä–∞–∑
FROM node:18-alpine AS runner

WORKDIR /app

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤
COPY --from=base /app/public ./public
COPY --from=base /app/.next/standalone ./
COPY --from=base /app/.next/static ./.next/static
COPY --from=base /app/prisma ./prisma
COPY --from=base /app/node_modules/.prisma ./node_modules/.prisma

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
RUN chown -R nextjs:nodejs /app
USER nextjs

# –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞
EXPOSE 3000

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV NODE_ENV=production
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["node", "server.js"]


